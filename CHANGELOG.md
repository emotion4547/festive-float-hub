# Журнал изменений

## 7 февраля 2026

### Обновление цветовой схемы хедера

#### Бегущая строка (AnnouncementBar.tsx)
- Изменён фон с бирюзового (secondary) на розовый (primary)

#### Навигационная панель (Header.tsx)
- Изменён фон навигации с розового (primary) на бирюзовый (secondary)
- Кнопка «Каталог товаров» осталась розовой (primary)
- Кнопка каталога теперь с закруглёнными краями (rounded-full) и выглядит как отдельная кнопка

---

### Оптимизация производительности и SEO

#### Оптимизация изображений
- Создан `src/lib/imageUtils.ts` — утилиты для работы с Supabase Storage Transform API
- Автоматическая конвертация в WebP, адаптивные `srcset`, ресайз изображений
- Создан компонент `src/components/ui/optimized-image.tsx` с lazy loading и skeleton-плейсхолдерами
- Интегрировано в `ProductCard.tsx`

#### SEO-структурированные данные (JSON-LD)
- Создан `src/lib/seoSchemas.ts` — генераторы схем для Product, BreadcrumbList, Organization, LocalBusiness, ItemList, FAQPage
- Интегрировано в страницы: ProductPage, Index, CatalogPage

#### Ресурсная оптимизация (index.html)
- Добавлен `preconnect` для Supabase
- Добавлен `dns-prefetch` для Яндекс.Метрики
- Добавлен `preload` для критичных шрифтов (Montserrat, Open Sans)

---

### Обновление футера

#### Добавлена ссылка на разработчика
- Добавлен текст "Сайт разработан командой Emotion Marketing" со ссылкой на t.me/emotion_marketing

---

### Оплата и оформление заказа
- Удалены: СБП, Онлайн-оплата картой
- Добавлены:
  - **Наличными при получении**
  - **Картой при получении**
  - **Счёт для юр. лиц** (связывается менеджер)
- Кнопка изменена с "Оплатить" на "Оформить заказ"

#### Telegram-уведомления
- Способ оплаты теперь отображается в читаемом виде (не код)

---

### UX-улучшения

#### Toast-уведомления
- Добавлено уведомление при добавлении товара в корзину
- Добавлено уведомление при добавлении/удалении из избранного
- Отображается название товара

#### Динамические рекомендации
- Блок "Вам может понравиться" в корзине и избранном
- Подтягивает товары из категорий товаров в корзине
- Если корзина пуста — показывает топ по рейтингу
- Создан хук `src/hooks/useRelatedProducts.ts`

---

### Исправления

#### Стабильность админ-панели (AuthContext.tsx)
- Исправлен race condition при проверке прав
- Разделена начальная загрузка и последующие изменения авторизации
- Прогресс в формах больше не слетает при обновлении

---

### Затронутые файлы:
1. `src/pages/CheckoutPage.tsx` - способы оплаты
2. `supabase/functions/send-telegram/index.ts` - формат уведомлений
3. `src/components/products/ProductCard.tsx` - toast для корзины/избранного
4. `src/pages/ProductPage.tsx` - toast для корзины/избранного
5. `src/hooks/useRelatedProducts.ts` - динамические рекомендации (новый)
6. `src/pages/CartPage.tsx` - интеграция рекомендаций
7. `src/pages/FavoritesPage.tsx` - интеграция рекомендаций
8. `src/contexts/AuthContext.tsx` - исправление race condition

---

## 4 февраля 2026

### SEO и аналитика

#### Яндекс.Метрика
- Добавлен счётчик Яндекс.Метрики (ID: 106627193)
- Включены: Вебвизор, карта кликов, ecommerce-аналитика
- Скрипт в `<head>`, noscript-fallback в `<body>`

#### Динамический Sitemap
- Создан Edge Function `supabase/functions/sitemap/index.ts`
- Генерирует XML-карту сайта с товарами, категориями, новостями и коллекциями
- URL: `/functions/v1/sitemap`

#### robots.txt
- Обновлён с правилами для поисковых ботов
- Добавлены ссылки на статический и динамический sitemap

---

### Исправления UI

#### Навигационное меню (Header.tsx)
- Исправлена деформация меню на промежуточных разрешениях (1024-1280px)
- Добавлен `whitespace-nowrap` для предотвращения переноса текста
- Адаптивные отступы: `px-2 xl:px-4`
- Адаптивный размер шрифта: `text-xs xl:text-sm`

---

### Затронутые файлы:
1. `index.html` - Яндекс.Метрика
2. `public/robots.txt` - правила для ботов
3. `supabase/functions/sitemap/index.ts` - динамический sitemap (новый)
4. `src/components/layout/Header.tsx` - исправление навигации

---

## 31 января 2026

### Изменения на главной странице (Index.tsx)

#### Удалён блок "Гарантия возврата"
- Убран четвёртый блок преимуществ "Гарантия возврата" с описанием "Вернем деньги если что-то пойдет не так"
- Теперь отображаются 3 блока преимуществ:
  - ✅ Свежие шары
  - ✅ Быстрая доставка  
  - ✅ Работаем ежедневно

#### Выравнивание блоков преимуществ
- Изменена сетка с `lg:grid-cols-4` на `sm:grid-cols-3`
- Теперь три блока равномерно распределены по ширине контейнера

#### Добавлена бегущая строка (AnnouncementBar)
- Создан новый компонент `src/components/layout/AnnouncementBar.tsx`
- Расположена между хедером и основным контентом
- Текст: **"Окончательную цену уточняйте при заказе. Доставка по городу от 500 руб."**
- Зацикленная анимация прокрутки (30 секунд на цикл)
- Розовый фон (primary) с белым текстом

---

### Изменения в футере (Footer.tsx)

#### Обновлено время работы
- **Было:** Детальное описание с примечанием о заказах после 20:00
- **Стало:** 
  - Время работы магазина: **С 10:00 до 20:00 ежедневно**
  - Приём заказов: **24/7**

---

### Изменения в базе данных

#### Очистка названий товаров
- Удалена приписка **"Сет"** из всех названий товаров в таблице `products`
- SQL: `UPDATE products SET name = TRIM(REPLACE(name, 'Сет', '')) WHERE name LIKE '%Сет%'`

---

### Технические детали

#### Затронутые файлы:
1. `src/pages/Index.tsx` - главная страница
2. `src/components/layout/Footer.tsx` - компонент футера
3. `src/components/layout/AnnouncementBar.tsx` - бегущая строка (новый)
4. `src/components/layout/Layout.tsx` - добавлен импорт AnnouncementBar
5. `src/index.css` - добавлена CSS-анимация marquee

#### Синхронизация данных:
- Социальные ссылки (WhatsApp, Telegram, VK) синхронизируются между хедером и футером через таблицу `social_links` в базе данных
- Управление ссылками доступно в админ-панели → Социальные сети
