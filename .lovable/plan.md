
# План внедрения Prerendering для SEO на VPS

## Проблема
Сайт на React SPA отдаёт пустой `<div id="root">` до выполнения JavaScript. Хотя Googlebot умеет рендерить JS, это может:
- Замедлить индексирование
- Ухудшить позиции в Яндекс (хуже работает с JS)
- Сломать превью в соцсетях и мессенджерах

## Выбранное решение: Prerender.io + Nginx

Prerendering — оптимальный вариант для вашего случая:
- Не требует переписывать код
- Работает с любым React SPA
- Боты получают готовый HTML, пользователи — обычный SPA

## Архитектура

```text
┌─────────────┐     ┌─────────────┐     ┌──────────────────┐
│   Запрос    │────▶│    Nginx    │────▶│   React SPA      │
│  (браузер)  │     │             │     │  (обычный путь)  │
└─────────────┘     └─────────────┘     └──────────────────┘

┌─────────────┐     ┌─────────────┐     ┌──────────────────┐
│   Запрос    │────▶│    Nginx    │────▶│  Prerender.io    │
│ (Googlebot) │     │ (проверка   │     │  (готовый HTML)  │
│             │     │  User-Agent)│     │                  │
└─────────────┘     └─────────────┘     └──────────────────┘
```

## Этапы реализации

### Этап 1: Создание sitemap.xml
Создам динамический sitemap со всеми публичными страницами сайта для поисковых роботов.

**Файл:** `public/sitemap.xml`

Включит:
- Главная страница (/)
- Каталог (/catalog)
- Страницы товаров (/product/:id) — генерируются из базы
- Информационные страницы (/delivery, /payment, /contacts и др.)
- Новости (/news, /news/:slug)
- Коллекции (/collection/:slug)

### Этап 2: Edge Function для динамического sitemap
Создам серверную функцию, которая будет генерировать актуальный sitemap с товарами из базы данных.

### Этап 3: Обновление robots.txt
Добавлю ссылку на sitemap и правила для ботов.

### Этап 4: Конфигурация Nginx для VPS

Предоставлю готовый конфиг nginx:
- Проксирование запросов ботов на Prerender.io
- Отдача статики React SPA
- Поддержка HTML5 History API (fallback на index.html)
- HTTPS с Let's Encrypt

### Этап 5: Инструкция по настройке Prerender.io
- Регистрация на prerender.io (есть бесплатный план до 250 страниц/месяц)
- Получение токена
- Настройка кэширования

---

## Технические детали

### Создаваемые файлы:
1. `public/sitemap.xml` — статический базовый sitemap
2. `supabase/functions/sitemap/index.ts` — динамический sitemap с товарами
3. Обновление `public/robots.txt`
4. `docs/nginx-vps-config.md` — инструкция по настройке VPS

### Альтернатива Prerender.io — Rendertron (self-hosted):
Если не хотите использовать внешний сервис, можно развернуть Rendertron на том же VPS. Это бесплатно, но требует больше ресурсов сервера.

---

## Ожидаемый результат
После внедрения:
- Googlebot, Yandexbot, Bingbot получают готовый HTML с контентом
- Превью в Telegram, WhatsApp, VK работают корректно
- Индексирование происходит быстрее и полнее
- Обычные пользователи получают быстрый SPA без изменений

